---
import type { Language } from '@domain/entities/Language';

interface Props {
  currentLang: Language;
}

const { currentLang } = Astro.props;
---

<div class="language-selector">
  <button
    id="language-toggle"
    class="language-button"
    aria-label="Change language"
    title="Change language"
  >
    <span class="current-lang">{currentLang.toUpperCase()}</span>
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="6 9 12 15 18 9"/>
    </svg>
  </button>
  
  <div id="language-dropdown" class="language-dropdown" hidden>
    <button class="language-option" data-lang="es">
      <span class="lang-code">ES</span>
      <span class="lang-name">Espa√±ol</span>
    </button>
    <button class="language-option" data-lang="en">
      <span class="lang-code">EN</span>
      <span class="lang-name">English</span>
    </button>
  </div>
</div>

<style>
  .language-selector {
    position: relative;
  }

  .language-button {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-md);
    background-color: transparent;
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    font-weight: 600;
    font-size: 0.875rem;
    transition: all var(--transition-fast);
    cursor: pointer;
  }

  .language-button:hover {
    background-color: var(--color-bg-secondary);
    border-color: var(--color-primary);
  }

  [data-theme="dark"] .language-button {
    color: #f1f5f9;
  }

  [data-theme="dark"] .language-button:hover {
    background-color: #1e293b;
  }

  .language-dropdown {
    position: absolute;
    top: calc(100% + 0.5rem);
    right: 0;
    background-color: var(--color-bg-primary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    min-width: 150px;
    z-index: 100;
    overflow: hidden;
  }

  [data-theme="dark"] .language-dropdown {
    background-color: #1e293b;
    border-color: #334155;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
  }

  .language-dropdown[hidden] {
    display: none;
  }

  .language-option {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    width: 100%;
    padding: 0.75rem 1rem;
    background: none;
    color: var(--color-text-primary);
    text-align: left;
    transition: background-color var(--transition-fast);
    border: none;
    cursor: pointer;
    font-family: var(--font-sans);
  }

  .language-option:hover {
    background-color: var(--color-bg-secondary);
  }

  [data-theme="dark"] .language-option {
    color: #f1f5f9;
  }

  [data-theme="dark"] .language-option:hover {
    background-color: #334155;
  }

  .lang-code {
    font-weight: 700;
    color: var(--color-primary);
  }

  .lang-name {
    font-size: 0.875rem;
  }
</style>

<script>
  const languageToggle = document.getElementById('language-toggle');
  const languageDropdown = document.getElementById('language-dropdown');
  const languageOptions = document.querySelectorAll('.language-option');

  if (languageToggle && languageDropdown) {
    languageToggle.addEventListener('click', () => {
      const isHidden = languageDropdown.hasAttribute('hidden');
      if (isHidden) {
        languageDropdown.removeAttribute('hidden');
      } else {
        languageDropdown.setAttribute('hidden', '');
      }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!languageToggle.contains(e.target as Node) && !languageDropdown.contains(e.target as Node)) {
        languageDropdown.setAttribute('hidden', '');
      }
    });
  }

  languageOptions.forEach(option => {
    option.addEventListener('click', () => {
      const lang = option.getAttribute('data-lang');
      if (lang) {
        localStorage.setItem('language', lang);
        const currentPath = window.location.pathname;
        const pathSegments = currentPath.split('/').filter(Boolean);
        
        // Remove language prefix if it exists
        if (['es', 'en'].includes(pathSegments[0])) {
          pathSegments.shift();
        }
        
        // Navigate to the language-specific path
        const newPath = `/${lang}${pathSegments.length > 0 ? '/' + pathSegments.join('/') : ''}`;
        window.location.href = newPath;
      }
    });
  });
</script>
