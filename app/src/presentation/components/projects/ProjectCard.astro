---
import type { CommonLabels, Language, Project, ProjectLabels, Skill } from '@/domain';
import TechBadge from '../ui/TechBadge.astro';

interface Props {
    project: Project;
    lang: Language;
    commonLabels: CommonLabels;
    projectLabels: ProjectLabels;
    showImage?: boolean;
    showTechnologies?: boolean;
    maxTech?: number;
    skills?: Skill[];
}

const { 
    project, 
    lang, 
    commonLabels, 
    projectLabels,
    showImage = false, 
    showTechnologies = true,
    maxTech = 5,
    skills = []
} = Astro.props;

const translate = (obj: any, lang: Language) => obj[lang] || obj.en || Object.values(obj)[0];
---

<article class="group bg-white dark:bg-slate-900 rounded-lg shadow-sm overflow-hidden flex flex-col h-full">
    {showImage && project.imageUrl && (
        <div class="w-full h-48 overflow-hidden bg-slate-50 dark:bg-slate-800">
            <img 
                src={project.imageUrl} 
                alt={translate(project.title, lang)} 
                width="400" 
                height="200"
                loading="lazy"
                class="w-full h-full object-cover transition-transform duration-200 group-hover:scale-105"
            />
        </div>
    )}
    
    <div class="p-6 flex flex-col flex-grow gap-4">
        <div>
            <h3 class="text-lg md:text-xl font-semibold text-slate-900 dark:text-slate-100 m-0">{translate(project.title, lang)}</h3>
        </div>

        <p class="text-slate-500 dark:text-slate-400 text-sm leading-relaxed flex-grow">{translate(project.description, lang)}</p>
        
        {showTechnologies && project.technologies && project.technologies.length > 0 && (
            <div class="flex flex-wrap gap-2 mt-2">
                {project.technologies.slice(0, maxTech).map((techId: string) => {
                    const skill = skills.find((s: any) => s.id === techId);
                    return (
                        <TechBadge 
                            text={skill?.name || techId} 
                            iconUrl={skill?.iconUrl}
                        />
                    );
                })}
                {project.technologies.length > maxTech && (
                    <TechBadge 
                        text={`+${project.technologies.length - maxTech}`} 
                        variant="more"
                    />
                )}
            </div>
        )}
        
        <div class="flex flex-wrap gap-3 mt-auto pt-4 border-t border-gray-200 dark:border-slate-700">
            <a href={`/${lang}/projects/${project.id}`} class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium transition-transform duration-150 bg-blue-500 text-white border border-blue-500 hover:bg-blue-600 hover:-translate-y-0.5 shadow-md">
                {translate(commonLabels.viewMore, lang)}
            </a>
            {project.demoUrl && (
                <a href={project.demoUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium transition-transform duration-150 bg-transparent text-slate-900 dark:text-slate-100 border border-gray-200 dark:border-slate-700 hover:border-blue-500 hover:text-blue-500 hover:-translate-y-0.5">
                    {translate(projectLabels.viewDemo, lang)}
                </a>
            )}
            {project.repoUrl && (
                <a href={project.repoUrl} target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-3 py-2 rounded-md text-sm font-medium transition-transform duration-150 bg-transparent text-slate-900 dark:text-slate-100 border border-gray-200 dark:border-slate-700 hover:border-blue-500 hover:text-blue-500 hover:-translate-y-0.5">
                    {translate(projectLabels.viewCode, lang)}
                </a>
            )}
        </div>
    </div>
</article>

