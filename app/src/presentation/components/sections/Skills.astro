---
import type { Language, CommonLabels } from '@domain/models';
import { translate } from '@/domain';
import Section from '../common/Section.astro';
import Button from '../common/ui/Button.astro';

interface Props {
    lang: Language;
    featured?: number; // Show top N skills
    commonLabels: CommonLabels;
}

const { lang, featured = 12, commonLabels } = Astro.props;

import { InMemorySkillsLabelsRepository, InMemorySkillRepository } from '@/data';
import { GetSkillsLabelsUseCase, GetSkillsUseCase } from '@/domain';
import CircuitPatternBackground from '@/presentation/backgrounds/CircuitPatternBackground.astro';

const skillsLabels = await new GetSkillsLabelsUseCase(new InMemorySkillsLabelsRepository()).execute();
const skills = await new GetSkillsUseCase(new InMemorySkillRepository()).execute();
---

<Section id="skills" class="skills" topFade bottomFade background='circuit' title={translate(skillsLabels.title, lang)} subtitle={translate(skillsLabels.subtitle, lang)}>
    
    <div class="max-w-7xl mx-auto px-4 relative z-10">

        <!-- Featured Skills Grid -->
        <div class="mb-8">
            <div class="grid gap-6 max-w-3xl mx-auto grid-cols-[repeat(auto-fit,minmax(120px,1fr))]">
                {skills
                .filter((skill) => !['architecture','methodologies'].includes(skill.category))
                .sort((a, b) => b.level - a.level)
                .slice(0, featured)
                .map((skill) => {
                    return (
                        <div title={skill.name} class="flex flex-col items-center gap-3 p-4 rounded-md transition-transform duration-200 hover:-translate-y-2 cursor-help bg-white dark:bg-slate-800 border border-gray-100 dark:border-slate-700">
                            <div class="w-14 h-14 flex items-center justify-center">
                                <img 
                                    src={skill.iconUrl} 
                                    alt={skill.name}
                                    width="56"
                                    height="56"
                                    loading="lazy"
                                    class="w-full h-full object-contain"
                                />
                            </div>
                            <h3 class="text-sm font-semibold text-slate-900 dark:text-slate-100 text-center">{skill.name}</h3>
                            <div class="w-full flex justify-center">
                                <span class="text-indigo-600 text-sm" aria-label={`${skill.level} de 5 estrellas`}>{'★'.repeat(skill.level)}</span>
                            </div>
                        </div>
                    );
                })}
            </div>
        </div>

        <!-- Link to Full Skills Page -->
        <div class="text-center">
            <Button href={"/" + lang + "/technologies"} variant="secondary" size="md">
                {translate(commonLabels.viewMore, lang)}<span class="ml-2 transition-transform">→</span>
            </Button>
        </div>
    </div>
</Section>

