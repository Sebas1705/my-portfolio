---
import type { Language, CommonLabels } from '@/domain';
import { translate } from '@/domain';
import { formatDateRange } from '@/core';
import Section from '../common/Section.astro';

interface Props {
    lang: Language;
    commonLabels: CommonLabels;
}

const { lang, commonLabels } = Astro.props;

import { InMemoryEducationLabelsRepository, InMemoryAcademicExperienceRepository, InMemoryProjectRepository } from '@/data';
import { GetEducationLabelsUseCase, GetAcademicExperiencesUseCase, GetProjectsByTypeUseCase } from '@/domain';

const educationLabels = await new GetEducationLabelsUseCase(new InMemoryEducationLabelsRepository()).execute();
const experiences = await new GetAcademicExperiencesUseCase(new InMemoryAcademicExperienceRepository()).execute();
const projects = await new GetProjectsByTypeUseCase(new InMemoryProjectRepository()).execute('academic');
---

<Section id="education" class="bg-white dark:bg-slate-900" title={translate(educationLabels.title, lang)} subtitle={translate(educationLabels.subtitle, lang)}>
    <div class="grid gap-8 max-w-7xl mx-auto">
        {experiences.map((experience, index) => {
            return (
                <article class="bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-md transition-transform duration-200 hover:-translate-y-1 hover:shadow-xl border border-gray-100 dark:border-slate-700" data-index={index}>
                    <div class="flex flex-col gap-4 mb-4 pb-4 border-b-2 border-gray-100 dark:border-slate-700 md:flex-row md:justify-between md:items-start">
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 dark:text-slate-100">{translate(experience.degree, lang)}</h3>
                            <p class="text-lg font-semibold text-indigo-600">{translate(experience.field, lang)}</p>
                            <p class="text-sm text-slate-500 font-medium">{translate(experience.institution, lang)}</p>
                        </div>
                        <div class="flex flex-col gap-1 text-sm text-slate-500">
                            <span>{formatDateRange(experience.startDate, experience.endDate, lang, translate(commonLabels.current, lang))}</span>
                            <span>{translate(experience.location, lang)}</span>
                        </div>
                    </div>

                    <p class="text-slate-600 dark:text-slate-300 leading-relaxed mb-4">{translate(experience.description, lang)}</p>

                    {experience.achievements.length > 0 && (
                        <div class="mb-4">
                            <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3">{translate(educationLabels.achievements, lang)}</h4>
                            <ul class="space-y-2">
                                {experience.achievements.map((achievement) => (
                                    <li class="flex items-start gap-2 text-slate-600 dark:text-slate-300">
                                        <span class="shrink-0">ðŸŽ“</span>
                                        <span>{translate(achievement, lang)}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}

                    {projects.filter((project) => project.relatedTo && project.relatedTo.includes(experience.id)).length > 0 && (
                        <div>
                            <h4 class="text-sm font-semibold text-slate-900 dark:text-slate-100 mb-3">{translate(educationLabels.projects, lang)}</h4>
                            <div class="grid gap-3">
                                {projects.filter((project) => project.relatedTo && project.relatedTo.includes(experience.id)).map(project => (
                                    <div class="p-4 bg-white dark:bg-slate-900 rounded-md border-l-4 border-indigo-500">
                                        <h5 class="text-sm font-semibold text-slate-900 dark:text-slate-100 mb-2">{translate(project.title, lang)}</h5>
                                        <p class="text-sm text-slate-600 dark:text-slate-300 mb-3">{translate(project.description, lang)}</p>
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            {project.technologies.slice(0, 3).map(tech => (
                                                <span class="badge-primary px-3 py-1 rounded-sm text-sm font-medium">{tech}</span>
                                            ))}
                                        </div>
                                        <div class="flex gap-4">
                                            {project.demoUrl && (
                                                <a href={project.demoUrl} target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 hover:text-indigo-500 underline">{translate(commonLabels.demo, lang)}</a>
                                            )}
                                            {project.repoUrl && (
                                                <a href={project.repoUrl} target="_blank" rel="noopener noreferrer" class="text-sm font-semibold text-indigo-600 hover:text-indigo-500 underline">{translate(commonLabels.code, lang)}</a>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </article>
            );
        })}
    </div>
</Section>
