---
import type { Language, CommonLabels } from '@/domain';
import { translate } from '@/domain';
import CourseCard from '@/presentation/components/common/cards/CourseCard.astro';
import Section from '@/presentation/components/common/Section.astro';
import SectionHeader from '@/presentation/components/common/ui/SectionHeader.astro';

interface Props {
    lang: Language;
    commonLabels: CommonLabels;
}

const { lang, commonLabels } = Astro.props;

import { InMemoryCourseRepository, InMemoryCourseLabelsRepository } from '@/data';
import { GetAllCoursesUseCase, GetCourseLabelsUseCase } from '@/domain';

const courseLabels = await new GetCourseLabelsUseCase(new InMemoryCourseLabelsRepository()).execute();
const courses = await new GetAllCoursesUseCase(new InMemoryCourseRepository()).execute();

const visibleCourses = courses
    .sort((a, b) => new Date(b.completionDate).getTime() - new Date(a.completionDate).getTime())
    .slice(0, 3);
---
<Section class="border-t border-gray-200/50">
    <SectionHeader
        title={translate(courseLabels.title, lang)}
        subtitle={translate(courseLabels.subtitle, lang)}
    />

    {visibleCourses.length > 0 ? (
        <div class="grid gap-5 mt-8 mb-10">
            {visibleCourses.map((course) => (
                <CourseCard course={course} lang={lang} courseLabels={courseLabels} />
            ))}
        </div>
    ) : (
        <p class="text-center text-slate-600 my-8">{translate(commonLabels.noData, lang)}</p>
    )}

    <div class="flex justify-center">
        <a href={`/${lang}/courses`} class="btn-primary inline-block px-4 py-2 rounded-md font-medium transform hover:-translate-y-0.5 transition">{translate(commonLabels.viewMore, lang)}</a>
    </div>
</Section>
<style>
    .courses-grid { grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
</style>
