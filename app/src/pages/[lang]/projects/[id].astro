---
import Layout from '../../../presentation/layouts/Layout.astro';
import Header from '../../../presentation/components/Header.astro';
import Footer from '../../../presentation/components/Footer.astro';

import type { Language } from '@domain/models/Language';
import personalInfoData from '@data/datasources/personalInfoData.json';
import projectsData from '@data/datasources/projectsData.json';
import navigationLabelsData from '@data/datasources/labels/navigationLabels.json';
import commonLabelsData from '@data/datasources/labels/commonLabels.json';
import projectLabelsData from '@data/datasources/labels/projectLabels.json';
import footerLabelsData from '@data/datasources/labels/footerLabels.json';
import { supportedLanguages, translate } from '@domain/models/Language';
import { PROJECT_TYPE_LABELS, formatMonthYear } from '@/core';

export async function getStaticPaths() {
    const paths = [];
    for (const l of supportedLanguages) {
        for (const project of projectsData) {
            paths.push({ params: { lang: l, id: project.id } });
        }
    }
    return paths;
}

const paramsLang = Astro.params.lang as Language | undefined;
const lang: Language = supportedLanguages.includes(paramsLang as Language) ? (paramsLang as Language) : 'en';
const { id } = Astro.params as { id: string };

const getStringFromTranslations = (value: any, lang: Language) => {
    if (!value) return '';
    if (typeof value === 'string') return value;
    if (typeof value === 'object') return value[lang] || Object.values(value)[0] || '';
    return '';
};


const personalInfo = personalInfoData;
const project = projectsData.find((p) => p.id === id);

// Use raw label objects (Translations) from datasources so domain translate can be used in components
const navigationLabels = navigationLabelsData;
const commonLabels = commonLabelsData;
const projectLabels = projectLabelsData;
const footerLabels = footerLabelsData;

const labels = {
    ...navigationLabels,
    ...commonLabels,
    ...projectLabels,
    ...footerLabels
};

if (!project) return Astro.redirect(`/${lang}/`);
---

<Layout lang={lang} title={`${translate(project.title, lang)} - ${personalInfo.name}`} description={`${translate(project.description, lang)}`}>
    <Header labels={labels} lang={lang} personalInfo={personalInfo} />
    
    <main class="project-detail-page">
        <div class="container">
            <div class="page-header">
                <a href={`/${lang}/#projects`} class="back-link">‚Üê {translate(labels.back, lang)}</a>
                <div class="project-meta">
                    <span class="type-badge" data-type={project.type}>{PROJECT_TYPE_LABELS[lang][project.type]}</span>
                    <span class="date">{formatMonthYear(project.startDate, lang)}</span>
                </div>
            </div>

            <div class="project-content">
                {project.imageUrl && (
                    <div class="project-image">
                        <img src={project.imageUrl} alt={translate(project.title, lang)} loading="lazy" />
                    </div>
                )}

                <article class="project-article">
                    <h1>{translate(project.title, lang)}</h1>
                    <p class="project-description">{translate(project.description, lang)}</p>

                    {project.technologies && project.technologies.length > 0 && (
                        <section class="technologies-section">
                            <h2>{translate(labels.projectTechnologies, lang)}</h2>
                            <div class="tech-list">
                                {project.technologies.map((tech) => (
                                    <span class="tech-tag">{tech}</span>
                                ))}
                            </div>
                        </section>
                    )}

                    <section class="links-section">
                        {project.demoUrl && (
                            <a href={project.demoUrl} target="_blank" rel="noopener noreferrer" class="btn btn-primary">
                                {translate(labels.projectViewDemo, lang)}
                            </a>
                        )}
                        {project.repoUrl && (
                            <a href={project.repoUrl} target="_blank" rel="noopener noreferrer" class="btn btn-secondary">
                                {translate(labels.projectViewCode, lang)}
                            </a>
                        )}
                    </section>
                </article>
            </div>
        </div>
    </main>

    <Footer labels={labels} lang={lang} />
</Layout>

<style>
    .project-detail-page {
        min-height: 100vh;
        padding: 4rem 0;
        background: linear-gradient(135deg, var(--color-bg-primary) 0%, var(--color-bg-secondary) 100%);
    }

    .page-header {
        margin-bottom: 3rem;
    }

    .project-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .type-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: var(--radius-md);
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .type-badge[data-type="work"] {
        background: rgba(59, 130, 246, 0.2);
        color: var(--color-primary);
    }

    .type-badge[data-type="academic"] {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
    }

    .type-badge[data-type="personal"] {
        background: rgba(168, 85, 247, 0.2);
        color: #a855f7;
    }

    .date {
        color: var(--color-text-secondary);
        font-size: 0.9rem;
    }

    .project-content {
        display: grid;
        grid-template-columns: 1fr;
        gap: 3rem;
    }

    .project-image {
        background: var(--color-bg-tertiary);
        border-radius: var(--radius-lg);
        overflow: hidden;
        border: 1px solid var(--color-border);
    }

    .project-image img {
        width: 100%;
        height: auto;
        display: block;
    }

    .project-article {
        background: var(--color-bg-tertiary);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: 3rem;
    }

    .project-article h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: var(--color-text-primary);
    }

    .project-description {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--color-text-secondary);
        margin-bottom: 2rem;
    }

    .technologies-section {
        margin-bottom: 2rem;
    }

    .technologies-section h2 {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--color-primary);
        margin-bottom: 1rem;
    }

    .tech-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .tech-tag {
        background: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-primary-lighter) 100%);
        color: var(--color-text-primary);
        padding: 0.5rem 1rem;
        border-radius: var(--radius-full);
        font-size: 0.9rem;
        font-weight: 500;
    }

    .links-section {
        display: flex;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--color-border);
    }

    .btn {
        display: inline-flex;
        align-items: center;
        padding: 0.75rem 1.5rem;
        border-radius: var(--radius-md);
        font-weight: 600;
        text-decoration: none;
        transition: all var(--transition-base);
        border: none;
        cursor: pointer;
        font-size: 1rem;
    }

    .btn-primary {
        background: var(--color-primary);
        color: white;
    }

    .btn-primary:hover {
        background: var(--color-primary-dark);
        transform: translateY(-2px);
    }

    .btn-secondary {
        background: var(--color-bg-secondary);
        color: var(--color-text-primary);
        border: 1px solid var(--color-border);
    }

    .btn-secondary:hover {
        border-color: var(--color-primary);
        color: var(--color-primary);
    }

    @media (max-width: 768px) {
        .project-article {
            padding: 1.5rem;
        }

        .project-article h1 {
            font-size: 1.8rem;
        }

        .links-section {
            flex-direction: column;
        }

        .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
