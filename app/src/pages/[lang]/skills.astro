---
import { supportedLanguages, translate } from '@/domain';
import type { Language } from '@domain/models/Language';
import Layout from '@/presentation/layouts/Layout.astro';
import Header from '@/presentation/components/sections/Header.astro';
import Footer from '@/presentation/components/sections/Footer.astro';

export async function getStaticPaths() {
    return supportedLanguages.map((lang) => ({ params: { lang } }));
}

const lang: Language = Astro.params.lang as Language;

import { InMemorySkillRepository, InMemorySkillsLabelsRepository, InMemoryPersonalInfoRepository, InMemoryCommonLabelsRepository } from '@/data';
import { GetSkillsUseCase, GetSkillsLabelsUseCase, GetPersonalInfoUseCase, GetCommonLabelsUseCase } from '@/domain';
import Section from '@/presentation/components/common/Section.astro';
import BackLink from '@/presentation/components/ui/BackLink.astro';

const skillsLabels = await new GetSkillsLabelsUseCase(new InMemorySkillsLabelsRepository()).execute();
const skills = await new GetSkillsUseCase(new InMemorySkillRepository()).execute();
const personalInfo = await new GetPersonalInfoUseCase(new InMemoryPersonalInfoRepository()).execute();
const commonLabels = await new GetCommonLabelsUseCase(new InMemoryCommonLabelsRepository()).execute();

const groupedSkills = skills.reduce((acc, skill) => {
    if (!acc[skill.category]) {
        acc[skill.category] = [];
    }
    acc[skill.category].push(skill);
    return acc;
}, {} as Record<string, typeof skills>);

const categoryLabels: Record<string, string> = {
    languages: translate(skillsLabels.categoryLanguages, lang),
    frameworks: translate(skillsLabels.categoryFrameworks, lang),
    tools: translate(skillsLabels.categoryTools, lang),
    ides: translate(skillsLabels.categoryIDES, lang),
    os: translate(skillsLabels.categoryOS, lang),
    databases: translate(skillsLabels.categoryDatabases, lang),
    cloud: translate(skillsLabels.categoryCloud, lang),
    ai: translate(skillsLabels.categoryAI, lang),
    architecture: translate(skillsLabels.categoryArchitecture, lang),
    methodologies: translate(skillsLabels.categoryMethodologies, lang),
};
---

<Layout lang={lang} title={`${translate(skillsLabels.title, lang)} - ${personalInfo.name}`} description={translate(skillsLabels.title, lang)}>
    <Header lang={lang} personalInfo={personalInfo} />
    
    <Section class="mt-15" background='circuit'>
        <div class="w-full px-15">
            <BackLink href={`/${lang}/#skills`} text={translate(commonLabels.back, lang)} />

            <div class="bg-bg-surface-alt-v border-2 border-primary-v rounded-3xl p-8 my-15 text-center mx-auto max-w-4xl">
                <h1 class="text-5xl text-primary-v font-bold mt-4">{translate(skillsLabels.title, lang)}</h1>
                <p class="text-2xl text-secondary-v my-5">{translate(skillsLabels.subtitle, lang)}</p>
                <div class="flex flex-wrap justify-center gap-8 items-center mt-10 mb-5">
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-accent-v text-lg tracking-wider">★</span>
                        <span class="text-sm font-medium text-bg-inverse-alt-v">{translate(skillsLabels.tierBasic, lang)}</span>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-accent-v text-lg tracking-wider">★★</span>
                        <span class="text-sm font-medium text-bg-inverse-alt-v">{translate(skillsLabels.tierBeginner, lang)}</span>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-accent-v text-lg tracking-wider">★★★</span>
                        <span class="text-sm font-medium text-bg-inverse-alt-v">{translate(skillsLabels.tierIntermediate, lang)}</span>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-accent-v text-lg tracking-wider">★★★★</span>
                        <span class="text-sm font-medium text-bg-inverse-alt-v">{translate(skillsLabels.tierAdvanced, lang)}</span>
                    </div>
                    <div class="flex flex-col items-center gap-2">
                        <span class="text-accent-v text-lg tracking-wider">★★★★★</span>
                        <span class="text-sm font-medium text-bg-inverse-alt-v">{translate(skillsLabels.tierExpert, lang)}</span>
                    </div>
                </div>
            </div>

            {Object.entries(groupedSkills).map(([category, categorySkills]) => (
                <section class="mb-16 w-full">
                    <h2 class="text-3xl font-semibold text-secondary-v mb-8 pb-4 border-b-2 border-primary-v">{categoryLabels[category]}</h2>
                    <div class="w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-10">
                        {categorySkills
                            .sort((a, b) => b.level - a.level)
                            .map((skill) => (
                                <div class="bg-bg-surface-alt-v border border-primary-v rounded-lg p-6 text-center transition-all duration-200 flex flex-col items-center justify-center hover:border-primary-v hover:shadow-lg hover:-translate-y-0.5">
                                    {skill.iconUrl && (<div class="my-10 grid place-items-center">
                                        <img src={skill.iconUrl} alt={skill.name} loading="lazy" class="size-26 object-contain" />
                                    </div>
                                    )}
                                    <h3 class="mb-5 overflow-hidden line-clamp-3 text-2xl text-secondary-v">{skill.name}</h3>
                                    
                                    <div class="mt-2 mb-4 text-accent-v font-extrabold">
                                        <span class="tracking-wide" title={`${skill.level}/5`}>
                                            {'★'.repeat(skill.level)}
                                        </span>
                                    </div>
                                </div>
                            ))}
                    </div>
                </section>
            ))}
        </div>
    </Section>

    <Footer lang={lang} />
</Layout>
 
